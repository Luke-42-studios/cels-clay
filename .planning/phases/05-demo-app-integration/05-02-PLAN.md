---
phase: 05-demo-app-integration
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - modules/cels-clay/examples/demo/main.c
  - modules/cels-clay/examples/demo/pages.h
autonomous: false

must_haves:
  truths:
    - "Sidebar shows three items (Home, Settings, About) and selected item is visually highlighted"
    - "Pressing j/k moves sidebar selection, h/l switches pane focus, Enter selects page"
    - "Home page shows nested layout elements demonstrating Clay capabilities"
    - "Settings page toggles work: Enter toggles show_borders and color_mode with immediate visual effect"
    - "About page scrolls with j/k when content pane is focused"
    - "Title bar and status bar are visible with borders at top and bottom"
  artifacts:
    - path: "modules/cels-clay/examples/demo/main.c"
      provides: "Working entry point that runs without crashes"
    - path: "modules/cels-clay/examples/demo/pages.h"
      provides: "Layout functions producing correct visual output"
  key_links:
    - from: "DemoInputSystem"
      to: "NavState"
      via: "CEL_Update mutations"
      pattern: "CEL_Update.*NavState"
    - from: "ContentRouter"
      to: "NavState"
      via: "CEL_Watch reactive recomposition"
      pattern: "CEL_Watch.*NavState"
    - from: "SettingsPage"
      to: "DemoSettings"
      via: "CEL_Update toggle + theme color reads"
      pattern: "DemoSettings"
---

<objective>
Build, run, and validate the demo app end-to-end. Fix any compilation errors, runtime crashes, or visual issues discovered during testing.

Purpose: Prove the full CELS + Clay + ncurses pipeline works -- the primary goal of Phase 5.

Output: A working, visually correct demo application that satisfies all four DEMO requirements.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-demo-app-integration/05-CONTEXT.md
@.planning/phases/05-demo-app-integration/05-RESEARCH.md
@.planning/phases/05-demo-app-integration/05-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build and fix compilation issues</name>
  <files>
    modules/cels-clay/examples/demo/main.c
    modules/cels-clay/examples/demo/pages.h
    modules/cels-clay/examples/demo/components.h
    modules/cels-clay/examples/demo/theme.h
  </files>
  <action>
Build the demo target and fix any compilation errors or warnings:

```bash
cd /home/cachy/workspaces/libs/cels
cmake --build build --target cels_clay_demo 2>&1
```

Common issues to watch for (from research):
1. Missing `clay.h` include in files using CLAY macros (clay_engine.h does NOT include clay.h)
2. Undeclared component IDs -- ensure NavItemData (or whatever component stores nav item label/index) has its ID accessible in layout functions
3. Clay API misuse -- CLAY_BORDER_OUTSIDE takes a width parameter, CLAY_PADDING_ALL takes int
4. `CEL_Clay_Text` returns `Clay_String`, used directly as first arg to `CLAY_TEXT`
5. `Clay_GetScrollOffset()` returns `Clay_Vector2` for `.childOffset`
6. Type mismatches between `Clay_Color` fields (uint8_t r,g,b,a)
7. Forward declaration issues with CEL_State (ensure both .h and .c see the state declarations)
8. `g_frame_state` needs `<cels-ncurses/tui_frame.h>` included

Fix each error iteratively until clean compilation. Keep fixes minimal -- don't restructure, just fix what's broken.

If the build system needs reconfiguring (e.g., new files added), run:
```bash
cd /home/cachy/workspaces/libs/cels/build && cmake .. && cmake --build . --target cels_clay_demo
```
  </action>
  <verify>
`cd /home/cachy/workspaces/libs/cels && cmake --build build --target cels_clay_demo 2>&1 | tail -5` shows successful build with zero errors.
  </verify>
  <done>
The `cels_clay_demo` target compiles cleanly. All source files have correct includes, types, and API usage.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete three-page demo app (Home, Settings, About) with sidebar navigation, theme toggle, border toggle, and scroll container. The app demonstrates CELS state management + Clay declarative layout + ncurses terminal rendering working together.
  </what-built>
  <how-to-verify>
Run the demo app in a terminal (Kitty recommended, not VS Code integrated terminal):

```bash
cd /home/cachy/workspaces/libs/cels
./build/cels_clay_demo
```

Verify each requirement:

1. **DEMO-01 - Sidebar + content layout**: Sidebar on left (~25% width), content area on right, separated by a visible divider. Title bar at top, status bar at bottom.

2. **DEMO-02 - Text rendering**: Static text on Home page renders correctly. Settings page shows dynamic text ("Show borders: ON/OFF", "Color mode: Theme A/B") that updates when toggled.

3. **DEMO-03 - Button highlight**: Press j/k to move sidebar selection -- selected item shows visual highlight (different background color). Press h/l to switch focus between sidebar and content pane.

4. **DEMO-04 - Full pipeline**:
   - Press Enter on sidebar items to switch pages
   - On Settings page (focus content with 'l', navigate with j/k): Enter toggles show_borders (borders appear/disappear on content area) and color_mode (colors change across the UI)
   - On About page: j/k scrolls the content when content pane is focused
   - Press 'q' to quit cleanly

Report any issues: visual glitches, incorrect layout proportions, missing text, unresponsive keys, crashes.
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. Demo app compiles without errors
2. App launches and displays sidebar + content layout
3. Navigation works: j/k moves selection, h/l switches pane, Enter selects
4. All three pages render: Home (showcase), Settings (toggles), About (scroll)
5. Settings toggles have immediate visual effect
6. No crashes during normal usage
7. Clean quit with 'q'
</verification>

<success_criteria>
- All four DEMO requirements (DEMO-01 through DEMO-04) verified by user
- App runs without crashes for normal usage patterns
- Visual output is correct and readable in the terminal
</success_criteria>

<output>
After completion, create `.planning/phases/05-demo-app-integration/05-02-SUMMARY.md`
</output>
